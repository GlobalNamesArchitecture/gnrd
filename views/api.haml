%p.api-warning<
  This API produces an immediate response containing a token URL to be polled. See the
  %a{:href => '#api-example'} example below
  ='.'

%h3 Base URL
#base-url
  - base_url = "#{SiteConfig.url_base}/name_finder.json"
  %p= base_url

%h3 Parameters (GET or POST)

%dl
  %dt url
  %dd
    An encoded URL for a web page, PDF, Microsoft Office document, or image file
    %br/
    %em e.g.
    = base_url + "?url=http://en.wikipedia.org/wiki/Animalia"
  %dt file
  %dd
    When using multipart/form-data as the content-type, a file may be sent.
  %dt text
  %dd
    Text content; best used with a POST request
    %br/
    %em e.g.
    =  base_url + "?text=A+spider+named+Pardosa+moesta+Banks,+1892"
  %dt engine
  %dd
    Optional. Either 1 for TaxonFinder, 2 for NetiNeti, or 0 for both. If absent, both engines are used.
    %br/
    %em e.g.
    = base_url + "?url=http://en.wikipedia.org/wiki/Animalia&amp;engine=1"
  %dt unique
  %dd
    Optional. If present, response has unique names without offsets.
    %br/
    %em e.g.
    = base_url + "?url=http://en.wikipedia.org/wiki/Animalia&amp;unique=true"
  %dt verbatim
  %dd
    Optional. If present, response excludes verbatim strings.
    %br/
    %em e.g.
    = base_url + "?url=http://en.wikipedia.org/wiki/Animalia&amp;verbatim=false"

%h3 Output Format
%dl
  %dt JSON (default)
  %dd
    With optional callback parameter
    %br/
    %em e.g.
    = base_url + "?url=http://en.wikipedia.org/wiki/Animalia&amp;callback=MyCoolCallback"
  %dt XML
  %dd
    %em e.g.
    = base_url.sub(/json/,'xml') + "?url=http://en.wikipedia.org/wiki/Animalia"

%h3
  %a{:name => "api-example"} Example

%p
  %em e.g.
  = base_url + "?url=http://en.wikipedia.org/wiki/Animalia"

%h4 Initial Response Containing Token URL

%p An HTTP status code of 303 "See Other" will be sent and the Location will be the token URL.

%pre.code
  :escaped
    {
      "token_url" : "#{base_url}?token=VmuYurv3QLyMXLABnqU1vg",
      "input_url" : "http://en.wikipedia.org/wiki/Animalia",
      "file"      : "",
      "status"    : 303,
      "engines"   : ["TaxonFinder", "NetiNeti"],
      "unique"    : false,
      "verbatim"  : true,
      "queue_size": 1
    }

%h4 Final Response After Having Polled Token URL

%pre.code
  :escaped
    {
      "token_url" : "#{base_url}?token=VmuYurv3QLyMXLABnqU1vg",
      "input_url" : "http://en.wikipedia.org/wiki/Animalia",
      "file"      : "",
      "status"    : 200,
      "engines"   : ["TaxonFinder", "NetiNeti"],
      "unique"    : false,
      "verbatim"  : true,
      "agent"     : {
        "code"         : "200",
        "content_type" : "text/html; charset=UTF-8",
        "filename"     : "Animalia.html"
      },
      "created"   : "2012-06-28T03:21:28-04:00",
      "execution_time" : {
        "find_names_duration" : 1.54374,
        "total_duration"      : 5.689187
      },
      "total"    : 34,
      "names":[
        {
          "verbatim"       : "Radiata",
          "scientificName" : "Radiata",
          "offsetStart"    : 20864,
          "offsetEnd"      : 20870
        },
        {
          "verbatim"       : "Radiata",
          "scientificName" : "Radiata",
          "offsetStart"    : 20960,
          "offsetEnd"      : 20966
        },
        ...etc...
      ]
    }